@using XClaim.Common.Dtos
@inject IBankService Http

@page "/app/settings/banks"

@code {
    private string Search { get; set; } = string.Empty;
    private bool Loading { get; set; }
    private DateRange _dateRange = WebConst.AppDateRange;
    private IEnumerable<BankResponse> _elements = new List<BankResponse>();
    
    protected override async Task OnInitializedAsync() {
        await LoadItems();
    }

    private async Task LoadItems() {
        this.Loading = true;
        _elements = await Http.GetBanksAsync();
        this.Loading = false;
    }

    private void CheckDeleted(bool result) {
        Console.WriteLine(result);
    }
    
    private Func<BankResponse, bool> Filter => x => {
        if (string.IsNullOrWhiteSpace(Search))
            return true;
        if (x.Name.Contains(Search, StringComparison.OrdinalIgnoreCase))
            return true;

        return false;
    };
    
    void RowClicked(DataGridRowClickEventArgs<BankResponse> args) { }

}

<Title>Banks</Title>

<MudDataGrid T="BankResponse" MultiSelection="true" Loading="Loading" Height="calc(100vh - 256px)" Hover="true" Items="@_elements" SortMode="SortMode.Multiple" Filterable="false" QuickFilter="@Filter"
             Hideable="true" RowClick="@RowClicked">
    <ToolBarContent>
        <TableToolbar TFilter="DateDialog" TValue="DateRange" TCreate="FormDialog" IsFilterActive="true" @bind-Value="_dateRange" @bind-Search="Search">
            <DeleteConfirmation OnDeleted="CheckDeleted"></DeleteConfirmation>
        </TableToolbar>
    </ToolBarContent>
    <LoadingContent>
         <TableLoading></TableLoading>
    </LoadingContent>
    <Columns>
        <SelectColumn T="BankResponse" />
        <Column T="BankResponse" Field="Name" />
        <Column T="BankResponse" Field="Description" />
        <Column T="BankResponse" Field="Active" />
        <Column T="BankResponse">
            <CellTemplate>
                <MudIconButton Class="pa-2" Icon="@Icons.Material.Filled.Edit" Variant="Variant.Filled" Color="Color.Warning" />
                <MudIconButton Class="pa-2 ml-1" Icon="@Icons.Material.Filled.Delete" Variant="Variant.Filled" Color="Color.Error" />
            </CellTemplate>
        </Column>
    </Columns>
    <PagerContent>
         <MudDataGridPager T="BankResponse" PageSizeOptions="WebConst.AppPaged" />
    </PagerContent>
</MudDataGrid>